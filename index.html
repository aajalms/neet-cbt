<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NEET PG CBT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{
  background:#003366;color:white;padding:10px 15px;
  display:flex;justify-content:space-between;align-items:center
}
.container{display:flex;height:calc(100vh - 50px)}
.main{width:70%;padding:20px;background:white}
.palette{width:30%;padding:10px;background:#eef2f6;border-left:1px solid #ccc}
.question{font-size:18px;margin-bottom:15px}
.options label{display:block;margin:8px 0}
.controls button{padding:8px 14px;margin:6px;font-weight:bold}
.palette button{
  width:38px;height:38px;margin:4px;border:none;
  font-weight:bold;color:white
}
.red{background:#e74c3c}
.green{background:#27ae60}
.yellow{background:#f1c40f;color:black}
.blue{background:#3498db}
.current{outline:3px solid black}
.timer{font-weight:bold}
</style>
</head>

<body>

<header>
  <div>NEET PG CBT</div>
  <div class="timer" id="timer">210:00</div>
  <div>Violations: <span id="vCount">0</span></div>
</header>

<div class="container">
  <div class="main">
    <div class="question" id="question"></div>
    <div class="options" id="options"></div>

    <div class="controls">
      <button onclick="prevQuestion()">Previous</button>
      <button onclick="nextQuestion()">Next</button>
      <button onclick="clearResponse()">Clear</button>
      <button onclick="markForReview()">Mark for Review</button>
      <button onclick="submitExam()">Submit</button>
    </div>
  </div>

  <div class="palette" id="palette"></div>
</div>

<script>
/* ================= DEV SAFETY ================= */
if(!sessionStorage.getItem("rollNo")){
  sessionStorage.setItem("rollNo","TEST001");
}

/* ================= QUESTIONS ================= */
const questions=[
 {q:"Pacemaker of heart is?",o:["AV node","SA node","Bundle of His","Purkinje fibers"],a:1},
 {q:"Most common nerve injured in humerus fracture?",o:["Ulnar","Radial","Median","Axillary"],a:1}
];

/* ================= STATE ================= */
let current=0;
let answers=Array(questions.length).fill(null);
let reviewSet=new Set();

/* ================= TIMER ================= */
let timeLeft=210*60;
const timerEl=document.getElementById("timer");
setInterval(()=>{
  let m=Math.floor(timeLeft/60),s=timeLeft%60;
  timerEl.innerText=`${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
  if(timeLeft--<=0) submitExam(true);
},1000);

/* ================= RENDER ================= */
function renderQuestion(){
  const q=questions[current];
  document.getElementById("question").innerText=`Question ${current+1}. ${q.q}`;
  const opt=document.getElementById("options");
  opt.innerHTML="";
  q.o.forEach((o,i)=>{
    opt.innerHTML+=`
      <label>
        <input type="radio" name="opt"
        ${answers[current]===i?"checked":""}
        onclick="answers[${current}]=${i}">
        ${o}
      </label>`;
  });
  updatePalette();
}

function updatePalette(){
  const p=document.getElementById("palette");
  p.innerHTML="";
  questions.forEach((_,i)=>{
    const b=document.createElement("button");
    b.innerText=i+1;
    if(reviewSet.has(i)&&answers[i]!=null)b.className="blue";
    else if(reviewSet.has(i))b.className="yellow";
    else if(answers[i]!=null)b.className="green";
    else b.className="red";
    if(i===current)b.classList.add("current");
    b.onclick=()=>{current=i;renderQuestion()};
    p.appendChild(b);
  });
}

/* ================= NAV ================= */
function nextQuestion(){if(current<questions.length-1){current++;renderQuestion()}}
function prevQuestion(){if(current>0){current--;renderQuestion()}}
function clearResponse(){answers[current]=null;renderQuestion()}
function markForReview(){
  reviewSet.has(current)?reviewSet.delete(current):reviewSet.add(current);
  renderQuestion();
}

/* ================= SUBMIT ================= */
function submitExam(auto=false){
  let score=0,correct=0,wrong=0,skipped=0;
  answers.forEach((a,i)=>{
    if(a===questions[i].a){score+=4;correct++}
    else if(a==null)skipped++;
    else{score--;wrong++}
  });

  sessionStorage.setItem("neetResult",JSON.stringify({
    rollNo:sessionStorage.getItem("rollNo"),
    total:questions.length,
    correct,wrong,skipped,score
  }));
  location.href="result.html";
}

/* INIT */
renderQuestion();
</script>

</body>
</html>
