<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NEET PG CBT - Result</title>
  <style>
    body{margin:0;font-family:Arial;background:#eef2f7;padding:20px;}
    .box{max-width:900px;margin:auto;background:#fff;border-radius:6px;padding:18px;box-shadow:0 2px 10px rgba(0,0,0,.08);}
    h2{margin:0 0 10px;background:#003366;color:#fff;padding:10px;border-radius:4px;}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
    .card{background:#f7f7f7;padding:12px;border-left:5px solid #003366;}
    .small{font-size:12px;color:#666;}
    button{margin-top:14px;background:#003366;color:#fff;border:0;padding:10px 12px;border-radius:4px;font-weight:bold;cursor:pointer;}
    pre{white-space:pre-wrap;background:#f8f9fa;padding:10px;border-radius:6px;border:1px solid #ddd;}
  </style>
</head>
<body>
  <div class="box">
    <h2>Result</h2>
    <div id="cand" class="small"></div>

    <div class="grid" style="margin-top:12px;">
      <div class="card">Score: <b id="score">0</b></div>
      <div class="card">Correct: <b id="correct">0</b></div>
      <div class="card">Wrong: <b id="wrong">0</b></div>
      <div class="card">Unattempted: <b id="unatt">0</b></div>
      <div class="card">Violations: <b id="viol">0</b></div>
      <div class="card">Submitted At: <b id="subtime">-</b></div>
    </div>

    <button onclick="review()">Show Answer Review</button>
    <pre id="reviewBox" style="display:none;"></pre>
  </div>

  <script src="questions.js"></script>
  <script>
    const c = JSON.parse(localStorage.getItem("candidate")||"null");
    const res = JSON.parse(localStorage.getItem("result")||"null");
    const state = JSON.parse(localStorage.getItem("cbt_state")||"null");
    const answers = JSON.parse(localStorage.getItem("userAnswers")||"[]");

    if(!c || !res){ location.href="login.html"; }

    document.getElementById("cand").innerText = `${c.name} (${c.roll})`;
    document.getElementById("score").innerText = res.score;
    document.getElementById("correct").innerText = res.correct;
    document.getElementById("wrong").innerText = res.wrong;
    document.getElementById("unatt").innerText = res.unattempted;
    document.getElementById("viol").innerText = (state?.violations ?? 0);
    document.getElementById("subtime").innerText = new Date(res.submittedAt).toLocaleString();

    function review(){
      const box = document.getElementById("reviewBox");
      box.style.display = "block";

      let out = "";
      questions.forEach((q,i)=>{
        const sel = answers[i];
        out += `Q${i+1}. ${q.q}\n`;
        q.options.forEach((op,idx)=>{
          const correct = (idx===q.answer) ? "âœ…" : "";
          const chosen = (sel===idx) ? "ðŸ‘‰" : "";
          out += `   ${String.fromCharCode(65+idx)}. ${op} ${chosen} ${correct}\n`;
        });
        out += "\n";
      });

      box.textContent = out;
      box.scrollIntoView({behavior:"smooth"});
    }
  </script>
</body>
</html>
